{"id":"node_modules/@aws-sdk/middleware-signing/dist/cjs/middleware.js","dependencies":[{"name":"/Users/spittela/code/giphlify/package.json","includedInParent":true,"mtime":1600722302325},{"name":"/Users/spittela/code/giphlify/.babelrc","includedInParent":true,"mtime":1599669969128},{"name":"/Users/spittela/code/giphlify/node_modules/@aws-sdk/middleware-signing/package.json","includedInParent":true,"mtime":1600722667514},{"name":"tslib","loc":{"line":4,"column":22},"parent":"/Users/spittela/code/giphlify/node_modules/@aws-sdk/middleware-signing/dist/cjs/middleware.js","resolved":"/Users/spittela/code/giphlify/node_modules/tslib/tslib.es6.js"},{"name":"@aws-sdk/protocol-http","loc":{"line":5,"column":30},"parent":"/Users/spittela/code/giphlify/node_modules/@aws-sdk/middleware-signing/dist/cjs/middleware.js","resolved":"/Users/spittela/code/giphlify/node_modules/@aws-sdk/protocol-http/dist/cjs/index.js"}],"generated":{"js":"\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getAwsAuthPlugin = exports.awsAuthMiddlewareOptions = exports.awsAuthMiddleware = void 0;\nvar tslib_1 = require(\"tslib\");\nvar protocol_http_1 = require(\"@aws-sdk/protocol-http\");\nvar isClockSkewed = function (newServerTime, systemClockOffset) {\n    return Math.abs(getSkewCorrectedDate(systemClockOffset).getTime() - newServerTime) >= 300000;\n};\nvar getSkewCorrectedDate = function (systemClockOffset) { return new Date(Date.now() + systemClockOffset); };\nfunction awsAuthMiddleware(options) {\n    return function (next) {\n        return function (args) {\n            return tslib_1.__awaiter(this, void 0, void 0, function () {\n                var signer, _a, output, _b, _c, _d, headers, dateHeader, serverTime;\n                return tslib_1.__generator(this, function (_e) {\n                    switch (_e.label) {\n                        case 0:\n                            if (!protocol_http_1.HttpRequest.isInstance(args.request))\n                                return [2 /*return*/, next(args)];\n                            if (!(typeof options.signer === \"function\")) return [3 /*break*/, 2];\n                            return [4 /*yield*/, options.signer()];\n                        case 1:\n                            _a = _e.sent();\n                            return [3 /*break*/, 3];\n                        case 2:\n                            _a = options.signer;\n                            _e.label = 3;\n                        case 3:\n                            signer = _a;\n                            _b = next;\n                            _c = [tslib_1.__assign({}, args)];\n                            _d = {};\n                            return [4 /*yield*/, signer.sign(args.request, {\n                                    signingDate: new Date(Date.now() + options.systemClockOffset),\n                                })];\n                        case 4: return [4 /*yield*/, _b.apply(void 0, [tslib_1.__assign.apply(void 0, _c.concat([(_d.request = _e.sent(), _d)]))])];\n                        case 5:\n                            output = _e.sent();\n                            headers = output.response.headers;\n                            dateHeader = headers && (headers.date || headers.Date);\n                            if (dateHeader) {\n                                serverTime = Date.parse(dateHeader);\n                                if (isClockSkewed(serverTime, options.systemClockOffset)) {\n                                    options.systemClockOffset = serverTime - Date.now();\n                                }\n                            }\n                            return [2 /*return*/, output];\n                    }\n                });\n            });\n        };\n    };\n}\nexports.awsAuthMiddleware = awsAuthMiddleware;\nexports.awsAuthMiddlewareOptions = {\n    name: \"awsAuthMiddleware\",\n    step: \"finalizeRequest\",\n    tags: [\"SIGNATURE\", \"AWSAUTH\"],\n    relation: \"after\",\n    toMiddleware: \"retryMiddleware\",\n};\nexports.getAwsAuthPlugin = function (options) { return ({\n    applyToStack: function (clientStack) {\n        clientStack.addRelativeTo(awsAuthMiddleware(options), exports.awsAuthMiddlewareOptions);\n    },\n}); };\n"},"sourceMaps":{"js":{"version":3,"file":"middleware.js","sourceRoot":"","sources":["../../src/middleware.ts"],"names":[],"mappings":";;;;AAAA,wDAAqD;AAarD,IAAM,aAAa,GAAG,UAAC,aAAqB,EAAE,iBAAyB;IACrE,OAAA,IAAI,CAAC,GAAG,CAAC,oBAAoB,CAAC,iBAAiB,CAAC,CAAC,OAAO,EAAE,GAAG,aAAa,CAAC,IAAI,MAAM;AAArF,CAAqF,CAAC;AAExF,IAAM,oBAAoB,GAAG,UAAC,iBAAyB,IAAK,OAAA,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,iBAAiB,CAAC,EAAxC,CAAwC,CAAC;AAErG,SAAgB,iBAAiB,CAC/B,OAA8B;IAE9B,OAAO,UAAC,IAAoC;QAC1C,OAAA,UAAgB,IAAqC;;;;;;4BACnD,IAAI,CAAC,2BAAW,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC;gCAAE,sBAAO,IAAI,CAAC,IAAI,CAAC,EAAC;iCAC9C,CAAA,OAAO,OAAO,CAAC,MAAM,KAAK,UAAU,CAAA,EAApC,wBAAoC;4BAAG,qBAAM,OAAO,CAAC,MAAM,EAAE,EAAA;;4BAAtB,KAAA,SAAsB,CAAA;;;4BAAG,KAAA,OAAO,CAAC,MAAM,CAAA;;;4BAAvF,MAAM,KAAiF;4BACxE,KAAA,IAAI,CAAA;uDACpB,IAAI;;4BACE,qBAAM,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;oCACvC,WAAW,EAAE,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,OAAO,CAAC,iBAAiB,CAAC;iCAC9D,CAAC,EAAA;gCAJW,qBAAM,6DAEnB,UAAO,GAAE,SAEP,UACF,EAAA;;4BALI,MAAM,GAAG,SAKb;4BAEM,OAAO,GAAK,MAAM,CAAC,QAAe,QAA3B,CAA4B;4BACrC,UAAU,GAAG,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,IAAI,OAAO,CAAC,IAAI,CAAC,CAAC;4BAC7D,IAAI,UAAU,EAAE;gCACR,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;gCAC1C,IAAI,aAAa,CAAC,UAAU,EAAE,OAAO,CAAC,iBAAiB,CAAC,EAAE;oCACxD,OAAO,CAAC,iBAAiB,GAAG,UAAU,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;iCACrD;6BACF;4BAED,sBAAO,MAAM,EAAC;;;;SACf;IApBD,CAoBC,CAAC;AACN,CAAC;AAzBD,8CAyBC;AAEY,QAAA,wBAAwB,GAA+D;IAClG,IAAI,EAAE,mBAAmB;IACzB,IAAI,EAAE,iBAAiB;IACvB,IAAI,EAAE,CAAC,WAAW,EAAE,SAAS,CAAC;IAC9B,QAAQ,EAAE,OAAO;IACjB,YAAY,EAAE,iBAAiB;CAChC,CAAC;AAEW,QAAA,gBAAgB,GAAG,UAAC,OAA8B,IAA0B,OAAA,CAAC;IACxF,YAAY,EAAE,UAAC,WAAW;QACxB,WAAW,CAAC,aAAa,CAAC,iBAAiB,CAAC,OAAO,CAAC,EAAE,gCAAwB,CAAC,CAAC;IAClF,CAAC;CACF,CAAC,EAJuF,CAIvF,CAAC","sourcesContent":["import { HttpRequest } from \"@aws-sdk/protocol-http\";\nimport {\n  FinalizeHandler,\n  FinalizeHandlerArguments,\n  FinalizeHandlerOutput,\n  FinalizeRequestHandlerOptions,\n  FinalizeRequestMiddleware,\n  Pluggable,\n  RelativeLocation,\n} from \"@aws-sdk/types\";\n\nimport { AwsAuthResolvedConfig } from \"./configurations\";\n\nconst isClockSkewed = (newServerTime: number, systemClockOffset: number) =>\n  Math.abs(getSkewCorrectedDate(systemClockOffset).getTime() - newServerTime) >= 300000;\n\nconst getSkewCorrectedDate = (systemClockOffset: number) => new Date(Date.now() + systemClockOffset);\n\nexport function awsAuthMiddleware<Input extends object, Output extends object>(\n  options: AwsAuthResolvedConfig\n): FinalizeRequestMiddleware<Input, Output> {\n  return (next: FinalizeHandler<Input, Output>): FinalizeHandler<Input, Output> =>\n    async function (args: FinalizeHandlerArguments<Input>): Promise<FinalizeHandlerOutput<Output>> {\n      if (!HttpRequest.isInstance(args.request)) return next(args);\n      const signer = typeof options.signer === \"function\" ? await options.signer() : options.signer;\n      const output = await next({\n        ...args,\n        request: await signer.sign(args.request, {\n          signingDate: new Date(Date.now() + options.systemClockOffset),\n        }),\n      });\n\n      const { headers } = output.response as any;\n      const dateHeader = headers && (headers.date || headers.Date);\n      if (dateHeader) {\n        const serverTime = Date.parse(dateHeader);\n        if (isClockSkewed(serverTime, options.systemClockOffset)) {\n          options.systemClockOffset = serverTime - Date.now();\n        }\n      }\n\n      return output;\n    };\n}\n\nexport const awsAuthMiddlewareOptions: FinalizeRequestHandlerOptions & RelativeLocation<any, any> = {\n  name: \"awsAuthMiddleware\",\n  step: \"finalizeRequest\",\n  tags: [\"SIGNATURE\", \"AWSAUTH\"],\n  relation: \"after\",\n  toMiddleware: \"retryMiddleware\",\n};\n\nexport const getAwsAuthPlugin = (options: AwsAuthResolvedConfig): Pluggable<any, any> => ({\n  applyToStack: (clientStack) => {\n    clientStack.addRelativeTo(awsAuthMiddleware(options), awsAuthMiddlewareOptions);\n  },\n});\n"]}},"error":null,"hash":"7f1ff02bfccb7e0407c61617ff8561d3","cacheData":{"env":{}}}